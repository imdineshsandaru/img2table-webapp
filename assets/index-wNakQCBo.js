(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function o(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(i){if(i.ep)return;i.ep=!0;const u=o(i);fetch(i.href,u)}})();function be(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Oe={exports:{}};(function(e){var t=function(o){var s=Object.prototype,i=s.hasOwnProperty,u=Object.defineProperty||function(n,r,a){n[r]=a.value},h,g=typeof Symbol=="function"?Symbol:{},v=g.iterator||"@@iterator",A=g.asyncIterator||"@@asyncIterator",b=g.toStringTag||"@@toStringTag";function m(n,r,a){return Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),n[r]}try{m({},"")}catch{m=function(r,a,l){return r[a]=l}}function w(n,r,a,l){var c=r&&r.prototype instanceof W?r:W,p=Object.create(c.prototype),E=new z(l||[]);return u(p,"_invoke",{value:Z(n,a,E)}),p}o.wrap=w;function T(n,r,a){try{return{type:"normal",arg:n.call(r,a)}}catch(l){return{type:"throw",arg:l}}}var N="suspendedStart",P="suspendedYield",I="executing",L="completed",y={};function W(){}function B(){}function R(){}var x={};m(x,v,function(){return this});var H=Object.getPrototypeOf,F=H&&H(H(d([])));F&&F!==s&&i.call(F,v)&&(x=F);var _=R.prototype=W.prototype=Object.create(x);B.prototype=R,u(_,"constructor",{value:R,configurable:!0}),u(R,"constructor",{value:B,configurable:!0}),B.displayName=m(R,b,"GeneratorFunction");function j(n){["next","throw","return"].forEach(function(r){m(n,r,function(a){return this._invoke(r,a)})})}o.isGeneratorFunction=function(n){var r=typeof n=="function"&&n.constructor;return r?r===B||(r.displayName||r.name)==="GeneratorFunction":!1},o.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,R):(n.__proto__=R,m(n,b,"GeneratorFunction")),n.prototype=Object.create(_),n},o.awrap=function(n){return{__await:n}};function G(n,r){function a(p,E,S,O){var k=T(n[p],n,E);if(k.type==="throw")O(k.arg);else{var ee=k.arg,K=ee.value;return K&&typeof K=="object"&&i.call(K,"__await")?r.resolve(K.__await).then(function($){a("next",$,S,O)},function($){a("throw",$,S,O)}):r.resolve(K).then(function($){ee.value=$,S(ee)},function($){return a("throw",$,S,O)})}}var l;function c(p,E){function S(){return new r(function(O,k){a(p,E,O,k)})}return l=l?l.then(S,S):S()}u(this,"_invoke",{value:c})}j(G.prototype),m(G.prototype,A,function(){return this}),o.AsyncIterator=G,o.async=function(n,r,a,l,c){c===void 0&&(c=Promise);var p=new G(w(n,r,a,l),c);return o.isGeneratorFunction(r)?p:p.next().then(function(E){return E.done?E.value:p.next()})};function Z(n,r,a){var l=N;return function(p,E){if(l===I)throw new Error("Generator is already running");if(l===L){if(p==="throw")throw E;return f()}for(a.method=p,a.arg=E;;){var S=a.delegate;if(S){var O=X(S,a);if(O){if(O===y)continue;return O}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(l===N)throw l=L,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);l=I;var k=T(n,r,a);if(k.type==="normal"){if(l=a.done?L:P,k.arg===y)continue;return{value:k.arg,done:a.done}}else k.type==="throw"&&(l=L,a.method="throw",a.arg=k.arg)}}}function X(n,r){var a=r.method,l=n.iterator[a];if(l===h)return r.delegate=null,a==="throw"&&n.iterator.return&&(r.method="return",r.arg=h,X(n,r),r.method==="throw")||a!=="return"&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var c=T(l,n.iterator,r.arg);if(c.type==="throw")return r.method="throw",r.arg=c.arg,r.delegate=null,y;var p=c.arg;if(!p)return r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y;if(p.done)r[n.resultName]=p.value,r.next=n.nextLoc,r.method!=="return"&&(r.method="next",r.arg=h);else return p;return r.delegate=null,y}j(_),m(_,b,"Generator"),m(_,v,function(){return this}),m(_,"toString",function(){return"[object Generator]"});function Q(n){var r={tryLoc:n[0]};1 in n&&(r.catchLoc=n[1]),2 in n&&(r.finallyLoc=n[2],r.afterLoc=n[3]),this.tryEntries.push(r)}function Y(n){var r=n.completion||{};r.type="normal",delete r.arg,n.completion=r}function z(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(Q,this),this.reset(!0)}o.keys=function(n){var r=Object(n),a=[];for(var l in r)a.push(l);return a.reverse(),function c(){for(;a.length;){var p=a.pop();if(p in r)return c.value=p,c.done=!1,c}return c.done=!0,c}};function d(n){if(n){var r=n[v];if(r)return r.call(n);if(typeof n.next=="function")return n;if(!isNaN(n.length)){var a=-1,l=function c(){for(;++a<n.length;)if(i.call(n,a))return c.value=n[a],c.done=!1,c;return c.value=h,c.done=!0,c};return l.next=l}}return{next:f}}o.values=d;function f(){return{value:h,done:!0}}return z.prototype={constructor:z,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(Y),!n)for(var r in this)r.charAt(0)==="t"&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=h)},stop:function(){this.done=!0;var n=this.tryEntries[0],r=n.completion;if(r.type==="throw")throw r.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function a(O,k){return p.type="throw",p.arg=n,r.next=O,k&&(r.method="next",r.arg=h),!!k}for(var l=this.tryEntries.length-1;l>=0;--l){var c=this.tryEntries[l],p=c.completion;if(c.tryLoc==="root")return a("end");if(c.tryLoc<=this.prev){var E=i.call(c,"catchLoc"),S=i.call(c,"finallyLoc");if(E&&S){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(E){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else if(S){if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(n,r){for(var a=this.tryEntries.length-1;a>=0;--a){var l=this.tryEntries[a];if(l.tryLoc<=this.prev&&i.call(l,"finallyLoc")&&this.prev<l.finallyLoc){var c=l;break}}c&&(n==="break"||n==="continue")&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var p=c?c.completion:{};return p.type=n,p.arg=r,c?(this.method="next",this.next=c.finallyLoc,y):this.complete(p)},complete:function(n,r){if(n.type==="throw")throw n.arg;return n.type==="break"||n.type==="continue"?this.next=n.arg:n.type==="return"?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):n.type==="normal"&&r&&(this.next=r),y},finish:function(n){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===n)return this.complete(a.completion,a.afterLoc),Y(a),y}},catch:function(n){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===n){var l=a.completion;if(l.type==="throw"){var c=l.arg;Y(a)}return c}}throw new Error("illegal catch attempt")},delegateYield:function(n,r,a){return this.delegate={iterator:d(n),resultName:r,nextLoc:a},this.method==="next"&&(this.arg=h),y}},o}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(Oe);var ae=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`;const Ce=ae;let ce=0;var pe=({id:e,action:t,payload:o={}})=>{let s=e;return typeof s>"u"&&(s=Ce("Job",ce),ce+=1),{id:s,action:t,payload:o}},U={};let se=!1;U.logging=se;U.setLogging=e=>{se=e};U.log=(...e)=>se?console.log.apply(void 0,e):null;const Te=pe,{log:V}=U,Re=ae;let le=0;var _e=()=>{const e=Re("Scheduler",le),t={},o={};let s=[];le+=1;const i=()=>s.length,u=()=>Object.keys(t).length,h=()=>{if(s.length!==0){const m=Object.keys(t);for(let w=0;w<m.length;w+=1)if(typeof o[m[w]]>"u"){s[0](t[m[w]]);break}}},g=(m,w)=>new Promise((T,N)=>{const P=Te({action:m,payload:w});s.push(async I=>{s.shift(),o[I.id]=P;try{T(await I[m].apply(void 0,[...w,P.id]))}catch(L){N(L)}finally{delete o[I.id],h()}}),V(`[${e}]: Add ${P.id} to JobQueue`),V(`[${e}]: JobQueue length=${s.length}`),h()});return{addWorker:m=>(t[m.id]=m,V(`[${e}]: Add ${m.id}`),V(`[${e}]: Number of workers=${u()}`),h(),m.id),addJob:async(m,...w)=>{if(u()===0)throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return g(m,w)},terminate:async()=>{Object.keys(t).forEach(async m=>{await t[m].terminate()}),s=[]},getQueueLen:i,getNumWorkers:u}};function Ae(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ie=e=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Ae=="function"&&(t.type="node"),typeof e>"u"?t:t[e]};const Ne=Ie("type")==="browser",Pe=Ne?e=>new URL(e,window.location.href).href:e=>e;var $e=e=>{const t={...e};return["corePath","workerPath","langPath"].forEach(o=>{e[o]&&(t[o]=Pe(t[o]))}),t},ge={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const Me="6.0.1",De={version:Me};var Be={workerBlobURL:!0,logger:()=>{}};const Fe=De.version,je=Be;var Ge={...je,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Fe}/dist/worker.min.js`},Ue=({workerPath:e,workerBlobURL:t})=>{let o;if(Blob&&URL&&t){const s=new Blob([`importScripts("${e}");`],{type:"application/javascript"});o=new Worker(URL.createObjectURL(s))}else o=new Worker(e);return o},We=e=>{e.terminate()},xe=(e,t)=>{e.onmessage=({data:o})=>{t(o)}},He=async(e,t)=>{e.postMessage(t)};const te=e=>new Promise((t,o)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:i}}})=>{o(Error(`File could not be read! Code=${i}`))},s.readAsArrayBuffer(e)}),ne=async e=>{let t=e;if(typeof e>"u")return"undefined";if(typeof e=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(o=>o.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(typeof HTMLElement<"u"&&e instanceof HTMLElement)e.tagName==="IMG"&&(t=await ne(e.src)),e.tagName==="VIDEO"&&(t=await ne(e.poster)),e.tagName==="CANVAS"&&await new Promise(o=>{e.toBlob(async s=>{t=await te(s),o()})});else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){const o=await e.convertToBlob();t=await te(o)}else(e instanceof File||e instanceof Blob)&&(t=await te(e));return new Uint8Array(t)};var Ye=ne;const ze=Ge,Ke=Ue,qe=We,Je=xe,Xe=He,Ve=Ye;var Ze={defaultOptions:ze,spawnWorker:Ke,terminateWorker:qe,onMessage:Je,send:Xe,loadImage:Ve};const Qe=$e,C=pe,{log:ue}=U,et=ae,M=ge,{defaultOptions:tt,spawnWorker:rt,terminateWorker:nt,onMessage:ot,loadImage:de,send:at}=Ze;let fe=0;var me=async(e="eng",t=M.LSTM_ONLY,o={},s={})=>{const i=et("Worker",fe),{logger:u,errorHandler:h,...g}=Qe({...tt,...o}),v={},A=typeof e=="string"?e.split("+"):e;let b=t,m=s;const w=[M.DEFAULT,M.LSTM_ONLY].includes(t)&&!g.legacyCore;let T,N;const P=new Promise((d,f)=>{N=d,T=f}),I=d=>{T(d.message)};let L=rt(g);L.onerror=I,fe+=1;const y=({id:d,action:f,payload:n})=>new Promise((r,a)=>{ue(`[${i}]: Start ${d}, action=${f}`);const l=`${f}-${d}`;v[l]={resolve:r,reject:a},at(L,{workerId:i,jobId:d,action:f,payload:n})}),W=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),B=d=>y(C({id:d,action:"load",payload:{options:{lstmOnly:w,corePath:g.corePath,logging:g.logging}}})),R=(d,f,n)=>y(C({id:n,action:"FS",payload:{method:"writeFile",args:[d,f]}})),x=(d,f)=>y(C({id:f,action:"FS",payload:{method:"readFile",args:[d,{encoding:"utf8"}]}})),H=(d,f)=>y(C({id:f,action:"FS",payload:{method:"unlink",args:[d]}})),F=(d,f,n)=>y(C({id:n,action:"FS",payload:{method:d,args:f}})),_=(d,f)=>y(C({id:f,action:"loadLanguage",payload:{langs:d,options:{langPath:g.langPath,dataPath:g.dataPath,cachePath:g.cachePath,cacheMethod:g.cacheMethod,gzip:g.gzip,lstmOnly:[M.DEFAULT,M.LSTM_ONLY].includes(b)&&!g.legacyLang}}})),j=(d,f,n,r)=>y(C({id:r,action:"initialize",payload:{langs:d,oem:f,config:n}})),G=(d="eng",f,n,r)=>{if(w&&[M.TESSERACT_ONLY,M.TESSERACT_LSTM_COMBINED].includes(f))throw Error("Legacy model requested but code missing.");const a=f||b;b=a;const l=n||m;m=l;const p=(typeof d=="string"?d.split("+"):d).filter(E=>!A.includes(E));return A.push(...p),p.length>0?_(p,r).then(()=>j(d,a,l,r)):j(d,a,l,r)},Z=(d={},f)=>y(C({id:f,action:"setParameters",payload:{params:d}})),X=async(d,f={},n={text:!0},r)=>y(C({id:r,action:"recognize",payload:{image:await de(d),options:f,output:n}})),Q=async(d,f)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return y(C({id:f,action:"detect",payload:{image:await de(d)}}))},Y=async()=>(L!==null&&(nt(L),L=null),Promise.resolve());ot(L,({workerId:d,jobId:f,status:n,action:r,data:a})=>{const l=`${r}-${f}`;if(n==="resolve")ue(`[${d}]: Complete ${f}`),v[l].resolve({jobId:f,data:a}),delete v[l];else if(n==="reject")if(v[l].reject(a),delete v[l],r==="load"&&T(a),h)h(a);else throw Error(a);else n==="progress"&&u({...a,userJobId:f})});const z={id:i,worker:L,load:W,writeText:R,readText:x,removeFile:H,FS:F,reinitialize:G,setParameters:Z,recognize:X,detect:Q,terminate:Y};return B().then(()=>_(e)).then(()=>j(e,t,s)).then(()=>N(z)).catch(()=>{}),P};const ye=me,st=async(e,t,o)=>{const s=await ye(t,1,o);return s.recognize(e).finally(async()=>{await s.terminate()})},it=async(e,t)=>{const o=await ye("osd",0,t);return o.detect(e).finally(async()=>{await o.terminate()})};var ct={recognize:st,detect:it},lt={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},ut={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const dt=_e,ft=me,ht=ct,pt=lt,gt=ge,mt=ut,{setLogging:yt}=U;var vt={languages:pt,OEM:gt,PSM:mt,createScheduler:dt,createWorker:ft,setLogging:yt,...ht};const wt=be(vt);async function Et(e){try{console.log("[OCR] Starting OCR process...");const t=await Lt(e);console.log("[OCR] Image loaded, starting recognition...");const s=(await wt.recognize(t,"eng",{tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789., ",preserve_interword_spaces:"1",tessedit_pageseg_mode:"6",tessedit_ocr_engine_mode:"3",tessjs_create_pdf:"0",tessjs_create_hocr:"0",logger:i=>{const u=Math.round(i.progress*100);console.log(`[OCR Progress] ${i.status}: ${u}%`);const h=document.getElementById("processingStatus");h&&(h.textContent=`${i.status} (${u}%)`)}})).data.text;if(console.log("[OCR] Recognition complete. Extracted text:",s),!s||s.trim()==="")throw new Error("No text was detected in the image. Please try with a clearer image.");return s}catch(t){throw console.error("[OCR Error]",t),new Error("Error performing OCR: "+(t.message||"Unknown error"))}}function Lt(e){return new Promise((t,o)=>{const s=new FileReader;s.onload=()=>{console.log("[FileReader] File loaded successfully"),t(s.result)},s.onerror=()=>{console.error("[FileReader Error] Error reading file"),o(new Error("Error reading file"))},s.readAsDataURL(e)})}function St(e){console.log("TEXT",e);try{const t=e.split(`
`).filter(h=>h.trim()!=="");if(t.length<2)throw new Error("Not enough data detected in the image.");const o=t[0].trim(),s=ve(o);if(!kt(s))throw new Error("Could not detect a valid header row with Name and subject columns.");const i=t.slice(1),u=[];for(const h of i){const g=bt(h,s);g&&u.push(g)}if(u.length===0)throw new Error("No valid data rows found in the image.");return u}catch(t){throw console.error("Parsing Error:",t),new Error("Error parsing table data: "+(t.message||"Invalid table format"))}}function ve(e){let t=e.trim().split(/\s{2,}/);if(t.length<4&&(t=e.trim().split(/\t+/),t.length<4)){const o=e.match(/\b[\w]+\b/g);o&&o.length>=4&&(t=o)}return t.map(o=>o.trim())}function kt(e){const t=e.map(i=>i.toLowerCase()),o=t.some(i=>i.includes("name")),s=[t.some(i=>i.includes("math")||i.includes("maths")),t.some(i=>i.includes("science")||i.includes("sci")),t.some(i=>i.includes("english")||i.includes("eng"))];return o&&s.filter(Boolean).length>=2}function bt(e,t){const o=ve(e);if(o.length<3||!o[0]||!Ot(o[0]))return null;const s=o.slice(1).map(i=>{const u=parseInt(i.replace(/[^\d]/g,""),10);return isNaN(u)?0:u});return{name:o[0],math:s[0]||0,science:s[1]||0,english:s[2]||0}}function Ot(e){return/[a-zA-Z]/.test(e)&&!/^\d+$/.test(e)}function Ct(e){try{const o=[...e.map(g=>{const v=Tt(g);return{...g,total:v}})].sort((g,v)=>v.total-g.total);let s=1,i=null,u=0;return o.map((g,v)=>(i!==null&&g.total===i?u++:(s=v+1-u,u=0),i=g.total,{...g,rank:s}))}catch(t){throw console.error("Calculation Error:",t),new Error("Error calculating results: "+(t.message||"Unknown error"))}}function Tt(e){const t=parseFloat(e.math)||0,o=parseFloat(e.science)||0,s=parseFloat(e.english)||0;return t+o+s}function Rt(e){const t=document.getElementById("resultsTableBody");t.innerHTML="",[...e].sort((s,i)=>s.rank-i.rank).forEach(s=>{const i=document.createElement("tr"),u=document.createElement("td");u.textContent=s.rank,u.style.fontWeight="bold",s.rank===1?u.style.color="var(--color-success)":s.rank===2?u.style.color="var(--color-primary)":s.rank===3&&(u.style.color="var(--color-accent)"),i.appendChild(u);const h=document.createElement("td");h.textContent=s.name,i.appendChild(h);const g=document.createElement("td");g.textContent=s.math,i.appendChild(g);const v=document.createElement("td");v.textContent=s.science,i.appendChild(v);const A=document.createElement("td");A.textContent=s.english,i.appendChild(A);const b=document.createElement("td");b.textContent=s.total,b.style.fontWeight="bold",s.rank===1&&(b.style.color="var(--color-success)"),i.appendChild(b),t.appendChild(i)}),_t()}function _t(){document.querySelectorAll("#resultsTableBody tr").forEach((t,o)=>{t.style.opacity="0",t.style.transform="translateY(10px)",setTimeout(()=>{t.style.transition="opacity 300ms ease, transform 300ms ease",t.style.opacity="1",t.style.transform="translateY(0)"},50*o)})}function At(e){try{const t=XLSX.utils.book_new(),o=It(e),s=XLSX.utils.json_to_sheet(o),i=[{wch:10},{wch:20},{wch:10},{wch:10},{wch:10},{wch:10}];s["!cols"]=i,XLSX.utils.book_append_sheet(t,s,"Student Marks"),XLSX.writeFile(t,"Student_Marks_Analysis.xlsx"),Nt()}catch(t){console.error("Export Error:",t),alert("Error exporting to Excel: "+(t.message||"Unknown error"))}}function It(e){return[...e].sort((o,s)=>o.rank-s.rank).map(o=>({Rank:o.rank,Name:o.name,Math:o.math,Science:o.science,English:o.english,Total:o.total}))}function Nt(){const e=document.getElementById("exportBtn"),t=e.innerHTML;e.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    Exported!
  `,e.classList.add("btn-success"),setTimeout(()=>{e.innerHTML=t,e.classList.remove("btn-success")},2e3)}const we=document.getElementById("uploadSection"),Ee=document.getElementById("processingSection"),Le=document.getElementById("resultsSection"),ie=document.getElementById("errorSection"),D=document.getElementById("uploadContainer"),oe=document.getElementById("fileInput"),re=document.getElementById("processingStatus"),Pt=document.getElementById("exportBtn"),$t=document.getElementById("resetBtn"),Mt=document.getElementById("errorResetBtn"),Se=document.getElementById("errorMessage");let J=null;function Dt(){Bt()}function Bt(){oe.addEventListener("change",Ft),D.addEventListener("dragover",jt),D.addEventListener("dragleave",Gt),D.addEventListener("drop",Ut),D.addEventListener("click",()=>oe.click()),Pt.addEventListener("click",Wt),$t.addEventListener("click",he),Mt.addEventListener("click",he)}function Ft(e){const t=e.target.files[0];t&&ke(t)}function jt(e){e.preventDefault(),e.stopPropagation(),D.classList.add("drag-over")}function Gt(e){e.preventDefault(),e.stopPropagation(),D.classList.remove("drag-over")}function Ut(e){e.preventDefault(),e.stopPropagation(),D.classList.remove("drag-over");const t=e.dataTransfer.files;if(t.length>0){const o=t[0];o.type.startsWith("image/")?ke(o):xt("Please upload an image file.")}}async function ke(e){try{q(Ee),re.textContent="Performing OCR on the image...";const t=await Et(e);re.textContent="Parsing extracted text...";const o=St(t);if(!o||o.length===0)throw new Error("Could not detect a proper table structure in the image. Please try with a clearer image.");re.textContent="Calculating results...",J=Ct(o),Rt(J),q(Le)}catch(t){console.error("Error processing file:",t),Se.textContent=t.message||"There was an error processing the image. Please try again with a clearer image.",q(ie)}}function Wt(){J&&At(J)}function he(){oe.value="",J=null,q(we)}function q(e){we.classList.add("hidden"),Ee.classList.add("hidden"),Le.classList.add("hidden"),ie.classList.add("hidden"),e.classList.remove("hidden"),e.classList.add("fade-in"),setTimeout(()=>{e.classList.remove("fade-in")},300)}function xt(e){Se.textContent=e,q(ie)}document.addEventListener("DOMContentLoaded",Dt);
