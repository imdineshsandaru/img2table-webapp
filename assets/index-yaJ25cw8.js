(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const u of i)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function o(i){const u={};return i.integrity&&(u.integrity=i.integrity),i.referrerPolicy&&(u.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?u.credentials="include":i.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(i){if(i.ep)return;i.ep=!0;const u=o(i);fetch(i.href,u)}})();function be(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Oe={exports:{}};(function(e){var t=function(o){var s=Object.prototype,i=s.hasOwnProperty,u=Object.defineProperty||function(n,r,a){n[r]=a.value},g,p=typeof Symbol=="function"?Symbol:{},v=p.iterator||"@@iterator",I=p.asyncIterator||"@@asyncIterator",b=p.toStringTag||"@@toStringTag";function m(n,r,a){return Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),n[r]}try{m({},"")}catch{m=function(r,a,l){return r[a]=l}}function w(n,r,a,l){var c=r&&r.prototype instanceof Y?r:Y,h=Object.create(c.prototype),E=new q(l||[]);return u(h,"_invoke",{value:ee(n,a,E)}),h}o.wrap=w;function R(n,r,a){try{return{type:"normal",arg:n.call(r,a)}}catch(l){return{type:"throw",arg:l}}}var M="suspendedStart",B="suspendedYield",N="executing",L="completed",y={};function Y(){}function G(){}function _(){}var x={};m(x,v,function(){return this});var z=Object.getPrototypeOf,U=z&&z(z(d([])));U&&U!==s&&i.call(U,v)&&(x=U);var A=_.prototype=Y.prototype=Object.create(x);G.prototype=_,u(A,"constructor",{value:_,configurable:!0}),u(_,"constructor",{value:G,configurable:!0}),G.displayName=m(_,b,"GeneratorFunction");function j(n){["next","throw","return"].forEach(function(r){m(n,r,function(a){return this._invoke(r,a)})})}o.isGeneratorFunction=function(n){var r=typeof n=="function"&&n.constructor;return r?r===G||(r.displayName||r.name)==="GeneratorFunction":!1},o.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,_):(n.__proto__=_,m(n,b,"GeneratorFunction")),n.prototype=Object.create(A),n},o.awrap=function(n){return{__await:n}};function W(n,r){function a(h,E,S,O){var k=R(n[h],n,E);if(k.type==="throw")O(k.arg);else{var re=k.arg,J=re.value;return J&&typeof J=="object"&&i.call(J,"__await")?r.resolve(J.__await).then(function(D){a("next",D,S,O)},function(D){a("throw",D,S,O)}):r.resolve(J).then(function(D){re.value=D,S(re)},function(D){return a("throw",D,S,O)})}}var l;function c(h,E){function S(){return new r(function(O,k){a(h,E,O,k)})}return l=l?l.then(S,S):S()}u(this,"_invoke",{value:c})}j(W.prototype),m(W.prototype,I,function(){return this}),o.AsyncIterator=W,o.async=function(n,r,a,l,c){c===void 0&&(c=Promise);var h=new W(w(n,r,a,l),c);return o.isGeneratorFunction(r)?h:h.next().then(function(E){return E.done?E.value:h.next()})};function ee(n,r,a){var l=M;return function(h,E){if(l===N)throw new Error("Generator is already running");if(l===L){if(h==="throw")throw E;return f()}for(a.method=h,a.arg=E;;){var S=a.delegate;if(S){var O=V(S,a);if(O){if(O===y)continue;return O}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(l===M)throw l=L,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);l=N;var k=R(n,r,a);if(k.type==="normal"){if(l=a.done?L:B,k.arg===y)continue;return{value:k.arg,done:a.done}}else k.type==="throw"&&(l=L,a.method="throw",a.arg=k.arg)}}}function V(n,r){var a=r.method,l=n.iterator[a];if(l===g)return r.delegate=null,a==="throw"&&n.iterator.return&&(r.method="return",r.arg=g,V(n,r),r.method==="throw")||a!=="return"&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var c=R(l,n.iterator,r.arg);if(c.type==="throw")return r.method="throw",r.arg=c.arg,r.delegate=null,y;var h=c.arg;if(!h)return r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y;if(h.done)r[n.resultName]=h.value,r.next=n.nextLoc,r.method!=="return"&&(r.method="next",r.arg=g);else return h;return r.delegate=null,y}j(A),m(A,b,"Generator"),m(A,v,function(){return this}),m(A,"toString",function(){return"[object Generator]"});function te(n){var r={tryLoc:n[0]};1 in n&&(r.catchLoc=n[1]),2 in n&&(r.finallyLoc=n[2],r.afterLoc=n[3]),this.tryEntries.push(r)}function K(n){var r=n.completion||{};r.type="normal",delete r.arg,n.completion=r}function q(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(te,this),this.reset(!0)}o.keys=function(n){var r=Object(n),a=[];for(var l in r)a.push(l);return a.reverse(),function c(){for(;a.length;){var h=a.pop();if(h in r)return c.value=h,c.done=!1,c}return c.done=!0,c}};function d(n){if(n){var r=n[v];if(r)return r.call(n);if(typeof n.next=="function")return n;if(!isNaN(n.length)){var a=-1,l=function c(){for(;++a<n.length;)if(i.call(n,a))return c.value=n[a],c.done=!1,c;return c.value=g,c.done=!0,c};return l.next=l}}return{next:f}}o.values=d;function f(){return{value:g,done:!0}}return q.prototype={constructor:q,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(K),!n)for(var r in this)r.charAt(0)==="t"&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=g)},stop:function(){this.done=!0;var n=this.tryEntries[0],r=n.completion;if(r.type==="throw")throw r.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function a(O,k){return h.type="throw",h.arg=n,r.next=O,k&&(r.method="next",r.arg=g),!!k}for(var l=this.tryEntries.length-1;l>=0;--l){var c=this.tryEntries[l],h=c.completion;if(c.tryLoc==="root")return a("end");if(c.tryLoc<=this.prev){var E=i.call(c,"catchLoc"),S=i.call(c,"finallyLoc");if(E&&S){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(E){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else if(S){if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(n,r){for(var a=this.tryEntries.length-1;a>=0;--a){var l=this.tryEntries[a];if(l.tryLoc<=this.prev&&i.call(l,"finallyLoc")&&this.prev<l.finallyLoc){var c=l;break}}c&&(n==="break"||n==="continue")&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var h=c?c.completion:{};return h.type=n,h.arg=r,c?(this.method="next",this.next=c.finallyLoc,y):this.complete(h)},complete:function(n,r){if(n.type==="throw")throw n.arg;return n.type==="break"||n.type==="continue"?this.next=n.arg:n.type==="return"?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):n.type==="normal"&&r&&(this.next=r),y},finish:function(n){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===n)return this.complete(a.completion,a.afterLoc),K(a),y}},catch:function(n){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===n){var l=a.completion;if(l.type==="throw"){var c=l.arg;K(a)}return c}}throw new Error("illegal catch attempt")},delegateYield:function(n,r,a){return this.delegate={iterator:d(n),resultName:r,nextLoc:a},this.method==="next"&&(this.arg=g),y}},o}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(Oe);var se=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`;const Te=se;let ce=0;var ge=({id:e,action:t,payload:o={}})=>{let s=e;return typeof s>"u"&&(s=Te("Job",ce),ce+=1),{id:s,action:t,payload:o}},H={};let ie=!1;H.logging=ie;H.setLogging=e=>{ie=e};H.log=(...e)=>ie?console.log.apply(void 0,e):null;const Ce=ge,{log:Z}=H,Re=se;let le=0;var _e=()=>{const e=Re("Scheduler",le),t={},o={};let s=[];le+=1;const i=()=>s.length,u=()=>Object.keys(t).length,g=()=>{if(s.length!==0){const m=Object.keys(t);for(let w=0;w<m.length;w+=1)if(typeof o[m[w]]>"u"){s[0](t[m[w]]);break}}},p=(m,w)=>new Promise((R,M)=>{const B=Ce({action:m,payload:w});s.push(async N=>{s.shift(),o[N.id]=B;try{R(await N[m].apply(void 0,[...w,B.id]))}catch(L){M(L)}finally{delete o[N.id],g()}}),Z(`[${e}]: Add ${B.id} to JobQueue`),Z(`[${e}]: JobQueue length=${s.length}`),g()});return{addWorker:m=>(t[m.id]=m,Z(`[${e}]: Add ${m.id}`),Z(`[${e}]: Number of workers=${u()}`),g(),m.id),addJob:async(m,...w)=>{if(u()===0)throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return p(m,w)},terminate:async()=>{Object.keys(t).forEach(async m=>{await t[m].terminate()}),s=[]},getQueueLen:i,getNumWorkers:u}};function Ae(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ie=e=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Ae=="function"&&(t.type="node"),typeof e>"u"?t:t[e]};const Ne=Ie("type")==="browser",Pe=Ne?e=>new URL(e,window.location.href).href:e=>e;var $e=e=>{const t={...e};return["corePath","workerPath","langPath"].forEach(o=>{e[o]&&(t[o]=Pe(t[o]))}),t},me={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const Me="6.0.1",Be={version:Me};var De={workerBlobURL:!0,logger:()=>{}};const Fe=Be.version,Ge=De;var Ue={...Ge,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Fe}/dist/worker.min.js`},je=({workerPath:e,workerBlobURL:t})=>{let o;if(Blob&&URL&&t){const s=new Blob([`importScripts("${e}");`],{type:"application/javascript"});o=new Worker(URL.createObjectURL(s))}else o=new Worker(e);return o},We=e=>{e.terminate()},He=(e,t)=>{e.onmessage=({data:o})=>{t(o)}},Ye=async(e,t)=>{e.postMessage(t)};const ne=e=>new Promise((t,o)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:i}}})=>{o(Error(`File could not be read! Code=${i}`))},s.readAsArrayBuffer(e)}),ae=async e=>{let t=e;if(typeof e>"u")return"undefined";if(typeof e=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(o=>o.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(typeof HTMLElement<"u"&&e instanceof HTMLElement)e.tagName==="IMG"&&(t=await ae(e.src)),e.tagName==="VIDEO"&&(t=await ae(e.poster)),e.tagName==="CANVAS"&&await new Promise(o=>{e.toBlob(async s=>{t=await ne(s),o()})});else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){const o=await e.convertToBlob();t=await ne(o)}else(e instanceof File||e instanceof Blob)&&(t=await ne(e));return new Uint8Array(t)};var xe=ae;const ze=Ue,Ke=je,qe=We,Je=He,Xe=Ye,Ve=xe;var Ze={defaultOptions:ze,spawnWorker:Ke,terminateWorker:qe,onMessage:Je,send:Xe,loadImage:Ve};const Qe=$e,C=ge,{log:ue}=H,et=se,F=me,{defaultOptions:tt,spawnWorker:rt,terminateWorker:nt,onMessage:ot,loadImage:de,send:at}=Ze;let fe=0;var ye=async(e="eng",t=F.LSTM_ONLY,o={},s={})=>{const i=et("Worker",fe),{logger:u,errorHandler:g,...p}=Qe({...tt,...o}),v={},I=typeof e=="string"?e.split("+"):e;let b=t,m=s;const w=[F.DEFAULT,F.LSTM_ONLY].includes(t)&&!p.legacyCore;let R,M;const B=new Promise((d,f)=>{M=d,R=f}),N=d=>{R(d.message)};let L=rt(p);L.onerror=N,fe+=1;const y=({id:d,action:f,payload:n})=>new Promise((r,a)=>{ue(`[${i}]: Start ${d}, action=${f}`);const l=`${f}-${d}`;v[l]={resolve:r,reject:a},at(L,{workerId:i,jobId:d,action:f,payload:n})}),Y=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),G=d=>y(C({id:d,action:"load",payload:{options:{lstmOnly:w,corePath:p.corePath,logging:p.logging}}})),_=(d,f,n)=>y(C({id:n,action:"FS",payload:{method:"writeFile",args:[d,f]}})),x=(d,f)=>y(C({id:f,action:"FS",payload:{method:"readFile",args:[d,{encoding:"utf8"}]}})),z=(d,f)=>y(C({id:f,action:"FS",payload:{method:"unlink",args:[d]}})),U=(d,f,n)=>y(C({id:n,action:"FS",payload:{method:d,args:f}})),A=(d,f)=>y(C({id:f,action:"loadLanguage",payload:{langs:d,options:{langPath:p.langPath,dataPath:p.dataPath,cachePath:p.cachePath,cacheMethod:p.cacheMethod,gzip:p.gzip,lstmOnly:[F.DEFAULT,F.LSTM_ONLY].includes(b)&&!p.legacyLang}}})),j=(d,f,n,r)=>y(C({id:r,action:"initialize",payload:{langs:d,oem:f,config:n}})),W=(d="eng",f,n,r)=>{if(w&&[F.TESSERACT_ONLY,F.TESSERACT_LSTM_COMBINED].includes(f))throw Error("Legacy model requested but code missing.");const a=f||b;b=a;const l=n||m;m=l;const h=(typeof d=="string"?d.split("+"):d).filter(E=>!I.includes(E));return I.push(...h),h.length>0?A(h,r).then(()=>j(d,a,l,r)):j(d,a,l,r)},ee=(d={},f)=>y(C({id:f,action:"setParameters",payload:{params:d}})),V=async(d,f={},n={text:!0},r)=>y(C({id:r,action:"recognize",payload:{image:await de(d),options:f,output:n}})),te=async(d,f)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return y(C({id:f,action:"detect",payload:{image:await de(d)}}))},K=async()=>(L!==null&&(nt(L),L=null),Promise.resolve());ot(L,({workerId:d,jobId:f,status:n,action:r,data:a})=>{const l=`${r}-${f}`;if(n==="resolve")ue(`[${d}]: Complete ${f}`),v[l].resolve({jobId:f,data:a}),delete v[l];else if(n==="reject")if(v[l].reject(a),delete v[l],r==="load"&&R(a),g)g(a);else throw Error(a);else n==="progress"&&u({...a,userJobId:f})});const q={id:i,worker:L,load:Y,writeText:_,readText:x,removeFile:z,FS:U,reinitialize:W,setParameters:ee,recognize:V,detect:te,terminate:K};return G().then(()=>A(e)).then(()=>j(e,t,s)).then(()=>M(q)).catch(()=>{}),B};const ve=ye,st=async(e,t,o)=>{const s=await ve(t,1,o);return s.recognize(e).finally(async()=>{await s.terminate()})},it=async(e,t)=>{const o=await ve("osd",0,t);return o.detect(e).finally(async()=>{await o.terminate()})};var ct={recognize:st,detect:it},lt={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},ut={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const dt=_e,ft=ye,ht=ct,pt=lt,gt=me,mt=ut,{setLogging:yt}=H;var vt={languages:pt,OEM:gt,PSM:mt,createScheduler:dt,createWorker:ft,setLogging:yt,...ht};const wt=be(vt);async function Et(e){try{console.log("[OCR] Starting OCR process...");const t=await Lt(e);console.log("[OCR] Image loaded, starting recognition...");const{data:{text:o}}=await wt.recognize(t,"eng",{tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789., ",preserve_interword_spaces:"1",tessedit_pageseg_mode:"6",tessedit_ocr_engine_mode:"3"});if(console.log("[OCR] Recognition complete. Extracted text:",o),!o||o.trim()==="")throw new Error("No text was detected in the image. Please try with a clearer image.");return o}catch(t){throw console.error("[OCR Error]",t),new Error("Error performing OCR: "+(t.message||"Unknown error"))}}function Lt(e){return new Promise((t,o)=>{const s=new FileReader;s.onload=()=>{console.log("[FileReader] File loaded successfully"),t(s.result)},s.onerror=()=>{console.error("[FileReader Error] Error reading file"),o(new Error("Error reading file"))},s.readAsDataURL(e)})}function St(e){console.log("TEXT",e);try{const t=e.split(`
`).filter(g=>g.trim()!=="");if(t.length<2)throw new Error("Not enough data detected in the image.");const o=t[0].trim(),s=we(o);if(!kt(s))throw new Error("Could not detect a valid header row with Name and subject columns.");const i=t.slice(1),u=[];for(const g of i){const p=bt(g,s);p&&u.push(p)}if(u.length===0)throw new Error("No valid data rows found in the image.");return u}catch(t){throw console.error("Parsing Error:",t),new Error("Error parsing table data: "+(t.message||"Invalid table format"))}}function we(e){let t=e.trim().split(/\s{2,}/);if(t.length<4&&(t=e.trim().split(/\t+/),t.length<4)){const o=e.match(/\b[\w]+\b/g);o&&o.length>=4&&(t=o)}return t.map(o=>o.trim())}function kt(e){const t=e.map(i=>i.toLowerCase()),o=t.some(i=>i.includes("name")),s=[t.some(i=>i.includes("math")||i.includes("maths")),t.some(i=>i.includes("science")||i.includes("sci")),t.some(i=>i.includes("english")||i.includes("eng"))];return o&&s.filter(Boolean).length>=2}function bt(e,t){const o=we(e);if(o.length<3||!o[0]||!Ot(o[0]))return null;const s=o.slice(1).map(i=>{const u=parseInt(i.replace(/[^\d]/g,""),10);return isNaN(u)?0:u});return{name:o[0],math:s[0]||0,science:s[1]||0,english:s[2]||0}}function Ot(e){return/[a-zA-Z]/.test(e)&&!/^\d+$/.test(e)}function Tt(e){try{const o=[...e.map(p=>{const v=Ct(p);return{...p,total:v}})].sort((p,v)=>v.total-p.total);let s=1,i=null,u=0;return o.map((p,v)=>(i!==null&&p.total===i?u++:(s=v+1-u,u=0),i=p.total,{...p,rank:s}))}catch(t){throw console.error("Calculation Error:",t),new Error("Error calculating results: "+(t.message||"Unknown error"))}}function Ct(e){const t=parseFloat(e.math)||0,o=parseFloat(e.science)||0,s=parseFloat(e.english)||0;return t+o+s}function Rt(e){const t=document.getElementById("resultsTableBody");t.innerHTML="",[...e].sort((s,i)=>s.rank-i.rank).forEach(s=>{const i=document.createElement("tr"),u=document.createElement("td");u.textContent=s.rank,u.style.fontWeight="bold",s.rank===1?u.style.color="var(--color-success)":s.rank===2?u.style.color="var(--color-primary)":s.rank===3&&(u.style.color="var(--color-accent)"),i.appendChild(u);const g=document.createElement("td");g.textContent=s.name,i.appendChild(g);const p=document.createElement("td");p.textContent=s.math,i.appendChild(p);const v=document.createElement("td");v.textContent=s.science,i.appendChild(v);const I=document.createElement("td");I.textContent=s.english,i.appendChild(I);const b=document.createElement("td");b.textContent=s.total,b.style.fontWeight="bold",s.rank===1&&(b.style.color="var(--color-success)"),i.appendChild(b),t.appendChild(i)}),_t()}function _t(){document.querySelectorAll("#resultsTableBody tr").forEach((t,o)=>{t.style.opacity="0",t.style.transform="translateY(10px)",setTimeout(()=>{t.style.transition="opacity 300ms ease, transform 300ms ease",t.style.opacity="1",t.style.transform="translateY(0)"},50*o)})}function At(e){try{const t=XLSX.utils.book_new(),o=It(e),s=XLSX.utils.json_to_sheet(o),i=[{wch:10},{wch:20},{wch:10},{wch:10},{wch:10},{wch:10}];s["!cols"]=i,XLSX.utils.book_append_sheet(t,s,"Student Marks"),XLSX.writeFile(t,"Student_Marks_Analysis.xlsx"),Nt()}catch(t){console.error("Export Error:",t),alert("Error exporting to Excel: "+(t.message||"Unknown error"))}}function It(e){return[...e].sort((o,s)=>o.rank-s.rank).map(o=>({Rank:o.rank,Name:o.name,Math:o.math,Science:o.science,English:o.english,Total:o.total}))}function Nt(){const e=document.getElementById("exportBtn"),t=e.innerHTML;e.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    Exported!
  `,e.classList.add("btn-success"),setTimeout(()=>{e.innerHTML=t,e.classList.remove("btn-success")},2e3)}const Ee=document.getElementById("uploadSection"),Le=document.getElementById("processingSection"),Se=document.getElementById("resultsSection"),ke=document.getElementById("errorSection"),T=document.getElementById("uploadContainer"),$=document.getElementById("fileInput"),oe=document.getElementById("processingStatus"),Pt=document.getElementById("exportBtn"),$t=document.getElementById("resetBtn"),Mt=document.getElementById("errorResetBtn"),Bt=document.getElementById("errorMessage");let X=null,P=!1;function Dt(){Ft()}function Ft(){$.addEventListener("change",async e=>{e.preventDefault();const t=e.target.files[0];t&&!P&&(t.type.startsWith("image/")?await he(t):showError("Please upload an image file."))}),T.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),P||T.classList.add("drag-over")}),T.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),T.classList.remove("drag-over")}),T.addEventListener("drop",async e=>{if(e.preventDefault(),e.stopPropagation(),T.classList.remove("drag-over"),!P&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];t.type.startsWith("image/")?await he(t):showError("Please upload an image file.")}}),T.addEventListener("click",e=>{!P&&e.target===T&&($.value="",$.click())}),Pt.addEventListener("click",Gt),$t.addEventListener("click",pe),Mt.addEventListener("click",pe)}async function he(e){if(!P)try{P=!0,$.disabled=!0,T.style.pointerEvents="none",Q(Le),oe.textContent="Performing OCR on the image...";const t=await Et(e);oe.textContent="Parsing extracted text...";const o=St(t);if(!o||o.length===0)throw new Error("Could not detect a proper table structure in the image. Please try with a clearer image.");oe.textContent="Calculating results...",X=Tt(o),Rt(X),Q(Se)}catch(t){console.error("Error processing file:",t),Bt.textContent=t.message||"There was an error processing the image. Please try again with a clearer image.",Q(ke)}finally{P=!1,$.disabled=!1,T.style.pointerEvents="auto",$.value=""}}function Gt(){X&&At(X)}function pe(){$.value="",$.disabled=!1,T.style.pointerEvents="auto",X=null,P=!1,Q(Ee)}function Q(e){Ee.classList.add("hidden"),Le.classList.add("hidden"),Se.classList.add("hidden"),ke.classList.add("hidden"),e.classList.remove("hidden"),e.classList.add("fade-in"),setTimeout(()=>{e.classList.remove("fade-in")},300)}document.addEventListener("DOMContentLoaded",Dt);
